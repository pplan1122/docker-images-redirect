name: docker_images_push

on: push

jobs:
  define-matrix:
    runs-on: ubuntu-latest

    outputs:
      filenames: ${{ steps.filenames.outputs.filenames}}

    steps:
      - name: check out localrepo
        uses: actions/checkout@v4

      - name: porcess the file
        id: filenames
        run: |
          mapfile -t ARRAY_FILENAMES < <(cat docker-images | awk '$1 !~ /^#/ {if($1)print}')
          echo ARRAY_FILENAMES
          json="filenames=["
          first=true
          for item in "${ARRAY_FILENAMES[@]}"; do
            if [ "$first" = true ]; then
              first=false
            else
              json="$json,"
            fi
            json="$json\"$item\""
          done
          json="$json]"
          echo "$json"
          echo "$json" >> "$GITHUB_OUTPUT"

          
  # get-images: 
  #   needs: define-matrix
  #   strategy:
  #     matrix:
  #       filename: ${{ fromJSON(needs.define-matrix.outputs.filenames) }}      
  #   uses: ./.github/workflows/docker_pull_one.yaml
  #   with:
  #     filename: ${{matrix.filename}}
  #     repo_name: ${{vars.ALIYUN_REPO_NAME}}
  #   secrets: inherit
