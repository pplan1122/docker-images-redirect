name: docker_images_push

on: push
env:
  REPO_NAME: ${{vars.ALIYUN_REPO_NAME}}
  USER: ${{secrets.ALIYUN_USERNAME}}
  PASS: ${{secrets.ALIYUN_PASSWORD}}

jobs:
  define-matrix:
    runs-on: ubuntu-latest
    steps:
      - name: check out localrepo
        uses: action/checkout@v4

      - name: porcess the filename
        run: |
          mapfile -t ARRAY_FILENAMES < docker-images
          echo 'filenames=[ "${ARRYA_FILENAMES[@]}" ] '>> "$GITHUB_OUTPUT"

  get-images: 
    runs-on: ubuntu-latest
    needs: define-matrix
    strategy:
      matrix:
        filename: ${{fromJSON(needs.defin-matrix.outputs.filenames)}}      
    
    steps:
      - name: call workflow
        uses: ./github/workflows/docker_pull_one
        with:
          filename: ${{matrix.filename}}
          repo_name: $REPO_NAME
        secrets:
          username: ${{env.USER}}
          password: ${{env.PASS}}

      - name: report filename
        run: |
          cat filename
          echo "${{toJSON(needs.outputs)}}"