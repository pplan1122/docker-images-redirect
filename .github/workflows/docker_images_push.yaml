name: docker_images_push

on: push
env:
  REPO_NAME: ${{vars.ALIYUN_REPO_NAME}}

jobs:
  define-matrix:
    runs-on: ubuntu-latest
    steps:
      - name: check out localrepo
        uses: actions/checkout@v4

      - name: porcess the filename
        run: |
          mapfile -t ARRAY_FILENAMES < docker-images
          echo filenames=[${ARRAY_FILENAMES[@]}] >> "$GITHUB_OUTPUT"
          echo "${ARRAY_FILENAMES[@]}"
          echo 'filenames=\[${ARRAY_FILENAMES[@]}\]'
          echo 'filenames=[${ARRAY_FILENAMES[@]}]'

  get-images: 
    needs: define-matrix
    runs-on: ubuntu-latest
    strategy:
      matrix:
        filename: ${{fromJSON(needs.defin-matrix.outputs.filenames)}}      
    # uses: ./.github/workflows/docker_pull_one.yaml
    # with:
    #   filename: ${{matrix.filename}}
    #   repo_name: $REPO_NAME
    # secrets: inherit
    steps:
      - run: |
          echo "$filename"
          echo '---'
          echo "${{ matrix.filename }}"

